setTimeout(function(){$("body").fadeIn()},500);window.magicodes={isDebug:!1,isMin:!1,modules:[{name:"login",module:"modules/login"},{name:"navs",module:"modules/navs"},{name:"odataGrid",module:"modules/odataGrid"}],getModule:function(n,t,i){var r=this;require(["jquery"],function(){var m,moduleName,modules;if(i&&(m=eval("window."+i),typeof m!="undefined")){$.isFunction(t)&&t(m);return}moduleName=n;modules=$.each(r.modules,function(t,i){if(i.name==n)return moduleName=r.isMin?i.module+".min":i.module,!1});require([moduleName],function(m){$.isFunction(t)&&(i&&eval("window."+i+"=m"),t(m))})})}};window.magicodes.messager={showMessage:function(n,t,i,r){var u={title:n,text:t,class_name:i};typeof r!="undefined"&&(typeof r.before_close!="undefined"&&(u.before_close=r.before_close),typeof r.after_open!="undefined"&&(u.after_open=r.after_open));this._addGritter(u)},showInfoMessage:function(n,t,i){this.showMessage(n,t,"gritter-info gritter-light",i)},showErrorMessage:function(n,t,i){this.showMessage(n,t,"gritter-error gritter-light",i)},showWarnMessage:function(n,t,i){this.showMessage(n,t,"gritter-warning gritter-light",i)},removeAll:function(){typeof $.gritter!="undefined"&&$.gritter.removeAll()},_addGritter:function(n){require(["jquery","jquery.gritter"],function(){$.gritter.add(n)})}};window.magicodes.dialog=function(){self=this;this.bootbox={dialog:function(n){self._bootbox(function(){self.bootbox.bootbox=bootbox.dialog(n);$.isFunction(n.func)&&n.func()})},confirm:function(n){self._bootbox(function(){bootbox.confirm(n.message,function(t){t&&$.isFunction(n.func)&&n.func()})})},hideAll:function(){bootbox.hideAll()}};this._bootbox=function(n){require(["bootbox"],function(){$.isFunction(n)&&n()})};this.colorbox=function(n){self._colorbox(function(){$.colorbox(n)})};this._colorbox=function(n){require(["jq.colorbox"],function(){$.isFunction(n)&&n()})}};window.magicodes.loader={show:function(n){var i=typeof n=="undefined"?$("body"):n,t;$loading=$('<div class="message-loading-overlay"><i class="fa-spin ace-icon fa fa-spinner orange2 bigger-180"><\/i><\/div>').css({"z-index":1e4});i.append($loading);this.$loading=$loading;t=this;t.onShow&&t.onShow()},close:function(){var n=this;n.onClose&&n.onClose();$(".message-loading-overlay").remove()}};window.magicodes.logger={log:function(){var n="[magicodes]"+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(n):window.opera&&window.opera.postError&&window.opera.postError(n)}};window.magicodes.api={request:function(n,t){switch(n.toUpperCase()){case"GET":case"DELETE":this._sendRequest({url:t.url,type:n,data:t.data,func:t.func,error:t.error});break;case"POST":case"PUT":this._sendRequest({url:t.url,type:n,data:JSON.stringify(t.data),func:t.func,error:t.error});break;default:this._sendRequest({url:t.url,type:n,data:t.data,func:t.func,error:t.error})}},_sendRequest:function(n){$.ajax({url:n.url,type:n.type,data:n.data,cache:!1,accepts:"application/json",dataType:"json",contentType:"application/json; charset=utf-8",statusCode:{200:function(t){$.isFunction(n.func)&&n.func(t,200)},201:function(t){$.isFunction(n.func)&&n.func(t,201)},401:function(){window.location.href="/Login"},204:function(t){$.isFunction(n.func)&&n.func(t,204)},400:function(t){var i=$.parseJSON(t.responseText),r,u,f;if(!$.isFunction(n.error)||!n.error(i,400))if(i.error)r=i.error.innererror&&i.error.innererror.message?i.error.innererror.message:i.error.message,magicodes.messager.showErrorMessage("错误",r.replace(/\r\n/gi,"<br />"));else if(i.ModelState){r=i.Message;u="<br />";for(f in i.ModelState)u+=i.ModelState[f]+"<br />";magicodes.messager.showErrorMessage("错误",r.replace(/\r\n/gi,"<br />")+u)}},500:function(t){var i=$.parseJSON(t.responseText),r;$.isFunction(n.error)&&n.error(i,400)||(i.error?(r=i.error.innererror&&i.error.innererror.message?i.error.innererror.message:i.error.message,magicodes.messager.showErrorMessage("操作失败",r.replace(/\r\n/gi,"<br />"))):i.Message?(r=i.Message,magicodes.messager.showErrorMessage("操作失败",r.replace(/\r\n/gi,"<br />"))):i.message&&(r=i.message,magicodes.messager.showErrorMessage("操作失败",r.replace(/\r\n/gi,"<br />"))))}}}).fail(function(n){var t=$.parseJSON(n.responseText);console.error(t)})}};window.magicodes.validator=function(n){var t=this,i={errorElement:"div",errorClass:"help-block",focusInvalid:!1,highlight:function(n){$(n).closest(".input-control").removeClass("success-state").addClass("error-state");$(n).closest(".form-group").removeClass("has-info").addClass("has-error")},success:function(n){$(n).closest(".input-control").removeClass("error-state").addClass("success-state");$(n).closest(".form-group").removeClass("has-error").addClass("has-info");$(n).remove()},errorPlacement:function(n,t){if(t.is("input[type=checkbox]")||t.is("input[type=radio]")){var i=t.closest("div.CheckBoxListBorder");i.find(":checkbox,:radio").length>1?i.append(n):n.insertAfter(t.nextAll(".lbl:eq(0)").eq(0))}else t.is(".select2")?n.insertAfter(t.siblings('[class*="select2-container"]:eq(0)')):t.is(".chosen-select")?n.insertAfter(t.siblings('[class*="chosen-container"]:eq(0)')):n.insertAfter(t.parent())},invalidHandler:function(n,t){var i=t.numberOfInvalids();i&&(t.errorList[0].element.focus(),magicodes.messager.showWarnMessage("警告","您有 "+i+" 个字段填写不符合要求，请根据下面的提示语进行修正。"))},$form:$("form"),initComplete:function(){}};t.options=$.extend(i,n);require(["jq.validation"],function(){t.options.$form.find("textarea[required],input[required],select[required]").each(function(){var t=$(this),n=t.closest(".form-group:not([hideRequired])").find("label:eq(0)");n||(n=t.closest(".input-control").prev("label"));n.find(".text-warning").length==0&&n.append('<span class="text-warning">*<\/span>')});jQuery.validator.addMethod("password",function(n,t){return this.optional(t)||n.length>=6&&/\d/.test(n)&&/[a-z]/i.test(n)},"密码必须大于6个字符并且至少涵盖一个数字和字母！");t.options.$form.validate(t.options);$.isFunction(t.options.initComplete)&&t.options.initComplete()})};window.magicodes.grid={init:function(n){require(["knockoutJs"],function(t){t.bindingHandlers.htmlValue={init:function(n,i){var r=function(){var t=i(),r=n.innerHTML;t(r)};t.utils.registerEventHandler(n,"keyup",r);t.utils.registerEventHandler(n,"input",r)},update:function(n,i){var r=t.utils.unwrapObservable(i())||"",u=n.innerHTML;r!==u&&(n.innerHTML=r)}};var r=function(){var i=this;this.addItem=function(n){this.items.push(n)};this.nextPage=function(){this.gridViewModel.currentPageIndex()<this.getTotalPages()&&this.gridViewModel.currentPageIndex(this.gridViewModel.currentPageIndex()+1)};this.previousPage=function(){this.gridViewModel.currentPageIndex()>1&&this.gridViewModel.currentPageIndex(this.gridViewModel.currentPageIndex()-1)};this.getTotalPages=function(){var n=this.gridViewModel.totalCount()/this.gridViewModel.pageSize();return Math.floor(n)+(n>Math.floor(n)?1:0)};this.getPagesArr=function(){var r=this.getTotalPages(),f=r>10?10:r,n=this.gridViewModel.currentPageIndex(),i=1,u=f;return n>5&&(r-n>5?(i=n-4,u=n+5):(i=n-9,u=r)),i<1&&(i=1),t.utils.range(i,u)};this.gridViewModel={pages:t.observable([]),dataRows:t.observableArray([]),pageSize:t.observable(typeof n.pageSize=="undefined"?10:n.pageSize),totalCount:t.observable(0),currentPageIndex:t.observable(1),pageOptions:t.observableArray([10,25,50,100])};this.$filter=null;this.$orderby=null;this.$select=null;this.filter=function(){if(typeof n.filterTemplate!="undefined"&&n.filterTemplate.length>0){var t=n.filterTemplate,r=t.replace(/\{[^\}]+\}/ig,function(n){var t=$(n.substr(1,n.length-2));return"'"+(t.length>0?t.val():"")+"'"});this.$filter=r;i.loadData()}};i.gridViewModel.totalCount.subscribe(function(){});i.gridViewModel.currentPageIndex.subscribe(function(){i.loadData()});i.gridViewModel.pageSize.subscribe(function(){var n=i.getTotalPages();i.gridViewModel.pages(i.getPagesArr());i.gridViewModel.currentPageIndex()>n&&i.gridViewModel.currentPageIndex(1);i.loadData()});this.loadData=function(){var r={$count:!0,$top:this.gridViewModel.pageSize(),$skip:(this.gridViewModel.currentPageIndex()-1)*this.gridViewModel.pageSize()};i.$filter!=null&&(r.$filter=i.$filter);i.$orderby!=null&&(r.$orderby=i.$orderby);magicodes.loader.show($(n.gridId));window.magicodes.api.request("GET",{url:n.url,data:r,func:function(n){$.each(n.value,function(n,i){i._selected=t.observable(!1)});i.gridViewModel.dataRows(n.value);i.gridViewModel.totalCount(n["@odata.count"]);i.gridViewModel.pages(i.getPagesArr());magicodes.loader.close()}})};this.init=function(){n.$orderby&&(i.$orderby=n.$orderby);n.$select&&(i.$select=n.$select);this.loadData();$.isFunction(n.inited)&&n.inited(n,t)};this.isAllSelected=t.computed({read:function(){var n=t.utils.arrayFirst(i.gridViewModel.dataRows(),function(n){return!n._selected()});return n==null},write:function(n){t.utils.arrayForEach(i.gridViewModel.dataRows(),function(t){t._selected(n)})}});this.edit=function(r){var u=new magicodes.dialog;window.magicodes.api.request("GET",{url:n.url+"("+r+")",data:{},func:function(r){var f=typeof n.eidtModel=="undefined"?{}:n.eidtModel;i.eidtModel=t.observable($.extend(r,f));u.bootbox.dialog({title:"编辑",message:"<div><\/div>",buttons:{ok:{label:"<i class='ace-icon fa fa-check'><\/i> 确定",className:"btn-sm btn-success",callback:function(){return i.validator&&!i.validator.options.$form.valid()?!1:(window.magicodes.api.request("PUT",{url:n.url,data:i.eidtModel(),func:function(n,t){console.debug(t);magicodes.messager.showInfoMessage("温馨提示","保存成功！");bootbox.hideAll();i.loadData();console.debug(n)}}),!1)}},cancel:{label:"取消",className:"btn-sm btn-danger",callback:function(){}}},show:!1,func:function(){u.bootbox.bootbox.on("shown.bs.modal",function(){t.renderTemplate("editTemplate",i.eidtModel,{afterRender:function(){i.validator=n.editFormId?new magicodes.validator({$form:$("#"+n.editFormId)}):new magicodes.validator;$.isFunction(n.afterEditDialogShow)&&n.afterEditDialogShow()}},$(".bootbox-body:eq(0)").get(0),"replaceChildren")});u.bootbox.bootbox.modal("show")}})}})};this.removeSelectedRows=function(){var r=i.getSelectedRows(),t;if(r.length==0){magicodes.messager.showWarnMessage("警告","请先选择需要删除的项！");return}t="";$.each(r,function(){t+=eval("v."+n.keyName)+"-"});t=t.substr(0,t.length-1);(new magicodes.dialog).bootbox.confirm({message:"确定要删除所选项么？",func:function(){var t=r.length;$.each(r,function(){var url=n.url+"("+eval("v."+n.keyName)+")";window.magicodes.api.request("DELETE",{url:url,data:{},func:function(){t--;t==0&&(i.gridViewModel.currentPageIndex(1),i.loadData(),magicodes.messager.showInfoMessage("温馨提示","操作成功！"))}})})}})};this.getSelectedRows=function(){return $.grep(i.gridViewModel.dataRows(),function(n){return n._selected()})};this.add=function(){var r=new magicodes.dialog,u=typeof n.addModel=="undefined"?{}:n.addModel;this.addModel=t.observable($.extend({},u));r.bootbox.dialog({title:"新增",message:"<div><\/div>",buttons:{ok:{label:"<i class='ace-icon fa fa-check'><\/i> 确定",className:"btn-sm btn-success",callback:function(){return i.validator&&!i.validator.options.$form.valid()?!1:(window.magicodes.api.request("POST",{url:n.url,data:i.addModel(),func:function(){magicodes.messager.showInfoMessage("温馨提示","创建成功！");bootbox.hideAll();i.loadData()}}),!1)}},cancel:{label:"取消",className:"btn-sm btn-danger",callback:function(){}}},show:!1,func:function(){r.bootbox.bootbox.on("shown.bs.modal",function(){t.renderTemplate("addTemplate",i.addModel,{afterRender:function(){i.validator=n.editFormId?new magicodes.validator({$form:$("#"+n.editFormId)}):new magicodes.validator;$.isFunction(n.afterEditDialogShow)&&n.afterEditDialogShow()}},$(".bootbox-body:eq(0)").get(0),"replaceChildren")});r.bootbox.bootbox.modal("show")}})}},i=new r;t.applyBindings(i);$(function(){i.init()})})}};window.magicodes.form=function(n){var i={reloadAfterSave:!1,api:"",onloaded:function(){},enterSave:!0,loadData:!0,bindElement:null,saveMethod:"PUT",onsaved:null,onsave:null,onViewModelCreated:null,onsaveError:null},t;this.options=$.extend(i,n);t=this;this.ViewModel=function(){var n=this,i;this.loading=ko.observable(!1);this.formData=ko.observable(null);this.firstLoad=!0;i=t.options.bindElement||document.body;n.loading.subscribe(function(n){n?magicodes.loader.show($(i)):magicodes.loader.close()});this.load=function(){n.loading(!0);magicodes.api.request("GET",{url:t.options.api,func:function(i){n.loading(!1);n.formData(i);n.firstLoad&&(n.firstLoad=!1,$.isFunction(t.options.onloaded)&&t.options.onloaded(i))},error:function(){n.loading(!1)}})};this.save=function(){if(n.validator&&!n.validator.options.$form.valid())return!1;(!t.options.onsave||t.options.onsave())&&(n.loading(!0),magicodes.api.request(t.options.saveMethod,{url:t.options.api,data:n.formData(),func:function(i,r){if(n.loading(!1),t.options.onsaved)t.options.onsaved(i,r,n);else magicodes.messager.showInfoMessage("温馨提示","保存成功！");t.options.reloadAfterSave&&n.formData(i)},error:function(i,r){return(n.loading(!1),t.options.onsaveError&&t.options.onsaveError(i,r))?!0:!1}}))};t.options.onViewModelCreated&&t.options.onViewModelCreated(n);n.validator=new magicodes.validator;t.options.loadData&&n.load();t.options.enterSave&&$(i).keypress(function(t){var i=t.which?t.which:t.keyCode;return i===13?($(this).find(":focus").trigger("blur"),n.save(),!1):!0})};this.bindingModel=function(){magicodes.getModule("knockoutJs",function(n){t.options.bindElement==null?n.applyBindings(new t.ViewModel):n.applyBindings(new t.ViewModel,t.options.bindElement)},"ko")}};
/*
//# sourceMappingURL=magicodes.min.js.map
*/